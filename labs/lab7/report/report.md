---
## Front matter
title: "Отчет по лабораторной работе №7"
subtitle: "по дисциплине: Математическое моделирование"
author: "Ким Михаил Алексеевич"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: false # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: PT Serif
romanfont: PT Serif
sansfont: PT Sans
monofont: PT Mono
mainfontoptions: Ligatures=TeX
romanfontoptions: Ligatures=TeX
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase
monofontoptions: Scale=MatchLowercase,Scale=0.9
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Продолжить знакомство с функционалом языка программирования Julia, дополнительных библиотек (DifferentialEquations, Plots), интерактивного блокнота Pluto, а также интерактивной командной строкой REPL. Продолжить ознакомление с языком моделирования Modelica и программным обеспечением OpenModelica. Используя эти средства, описать математическую модель рекламной компании.

# Задание

Постройте график распространения рекламы, математическая модель которой описывается следующим уравнением:

1. $\frac{dn}{dt} = (0.77+0.00017n(t))(N-n(t))$

1. $\frac{dn}{dt} = (0.000055+0.29n(t))(N-n(t))$

1. $\frac{dn}{dt} = (0.5 \cdot t + 0.3 \cdot t \cdot n(t))(N-n(t))$

При этом объем аудитории $N=610$, в начальный момент о товаре знает $10$ человек. Для случая 2 определите в какой момент времени скорость распространения рекламы будет иметь максимальное значение.

# Теоретическое введение
## Модель рекламной кампании

__Модель рекламной кампании__ — математическая модель, описывающая скорость распространения информации о новом товаре какой-либо компании среди потенциальных покупателей. В нашем случае будем считать, что при распространении информации о товаре на покупателя, он сразу же готов купить рекламируемый товар.

Оценка скорости распространения информации о товаре важна при оценки прибыли от будущих продаж товара по сравнению с избытками издержек, потраченных на рекламу. Вначале расходы на рекламу могут превышать прибыль, но по мере увеличения числа продаж увеличивается прибыль. Однако реклама становится бесполезной, когда рынок насыщается.

Математическая модель рекламной кампании описывается следующим ОДУ:

$$\frac{dn}{dt} = (\alpha_1(t) + \alpha_2(t)n(t))(N-n(t)), $$

где $N$ — число потенциальных клиентов; $n(t)$ — число клиентов, информированных о товаре и готовых его купить; $\frac{dn}{dt}$ — изменение числа клиентов, информированных о товаре и готовых его купить, со временем; $\alpha_1(t)$ — величина, характеризующая интенсивность рекламной компании; $\alpha_2(t)$ — величина, характеризующая интенсивность т.н. «сарафанного радио».

При $\alpha_1(t)$ значительно большем, чем $\alpha_2(t)$, график зависимости $n(t)$ от $t$ будет являться экспоненциальным графиком, а математическая модель будет называться моделью Мальтуса.

При $\alpha_1(t)$ значительно меньшем, чем $\alpha_2(t)$, получим уравнение логистической кривой [@bib_1].


## Уравнение модели Мальтуса

__Модель Мальтуса__ — это математическая модель, разработанная теоретиком демографии Томасом Мальтусом в XVIII веке, для описания изменения численности населения в течение времени. Мальтус утверждал, что население удваивается каждые 25 лет, а производство продовольствия может увеличиться только линейно. Следовательно, рост населения будет приводить к недостатку пищи и, в конечном итоге, к голоду, болезням и смерти, которые уменьшат численность населения до уровня, соответствующего доступным ресурсам [@bib_2].

Модель Мальтуса описывает экспоненциальный рост численности населения. Она основана на предположении, что скорость роста численности населения пропорциональна численности населения в данный момент времени. Если обозначить численность населения в момент времени $t$ через $P(t)$, то модель Мальтуса можно записать в следующей форме:

$$ \frac{dP}{dt} = r \cdot N, $$

где $dP/dt$ — скорость изменения численности населения со временем, $P$ — текущая численность населения, $r$ — коэффициент рождаемости.

Решением этого дифференциального уравнения является экспоненциальная функция:

$$ P(t) = P_0 \cdot e^{rt}, $$

где $P(t)$ — численность населения в момент времени $t$, $P_0$ — исходная численность населений, $r$ — темп прироста населения («мальтузианский параметр»).

Таким образом, модель Мальтуса описывает экспоненциальный рост численности населения, то есть увеличение численности населения со временем происходит не пропорционально, а с постоянной скоростью, и эта скорость также увеличивается со временем. Однако, следует отметить, что в реальной жизни экспоненциальный рост на неограниченном промежутке времени невозможен, так как имеются ограничения в ресурсах и пространстве, необходимых для поддержания роста численности населения.

Модель Мальтуса имеет множество ограничений: она не учитывает такие факторы, как миграция, изменения в общественной политике и технологическом прогрессе, которые также влияют на изменение численности населения. Несмотря на это, модель Мальтуса остается важным теоретическим инструментом в изучении демографии и популяционных процессов [@bib_3].


## Уравнение логистической кривой

__Логистическое уравнение__ — это S-образная кривая (сигмоидальная кривая), изначально используемая при построении математических моделей, описывающих изменение размера популяции со временем с учетом ограничений, налагаемых окружающей средой. Уравнение было предложено Пьером Ферхюльстем в 1838 году [@bib_4].

Логистическое уравнение имеет следующий вид:

$$\frac{dN}{dt} = rN(1-\frac{N}{K})$$

где $N$ — размер популяции в момент времени $t$, $r$ — скорость роста популяции (без учета ограничений), $K$ — предельная вместимость среды.

Первое слагаемое в скобках описывает скорость роста популяции, а второе - ограничивает этот рост учитывая, что на определенном уровне популяции возможности среды ограничивают скорость дальнейшего роста [@bib_5].

Важно отметить, что при малых значениях $N$, то есть когда популяция еще не насытила среду, рост популяции описывается экспоненциальной моделью (без второго слагаемого в скобках). Однако при увеличении размера популяции, ограничения среды начинают влиять на скорость роста, и популяция переходит на устойчивое состояние - точку равновесия, которая соответствует величине $K$.

Логистическое уравнение находит применение в различных областях, таких как экология, демография, экономика, теория управления и другие [@bib_6].


# Выполнение лабораторной работы
## Pluto.jl
### Задание №1

1. Пишем программу, воспроизводящую модель на языке программирования Julia с использованием интерактивного блокнота Pluto (рис. @fig:01, @fig:02, @fig:03, @fig:04, @fig:05, @fig:06).

    ```Julia
    begin
    	import Pkg
    	Pkg.activate()
    	using DifferentialEquations
    	using LaTeXStrings
    	import Plots
    end
    ```

    ```Julia
    begin
    	const N = 610
    	const n₀ = 10
    	const α₁ = 0.000055
    	const α₂ = 0.29

    	"max_der[1] - dn/dt, max_der[2] - n, max_der[3] - t"
    	max_der = [-1e6, 0, 0]

    	"Начальные условия: u₀[1] - n"
    	u₀ = [n₀]

    	"Период времени"
    	T = (0.0, 0.1)
    end
    ```

    ```Julia
    "Правая часть нашей системы, p не используется. u[1] - n"
    function F!(du, u, p, t)
    	du[1] = (α₁ + α₂ * u[1]) * (N - u[1])

    	if du[1] > max_der[1]
    		max_der[1] = du[1]
    		max_der[2] = u[1]
    		max_der[3] = t
    	end
    end
    ```

    ```Julia
    prob = ODEProblem(F!, u₀, T)
    ```

    ```Julia
    sol = solve(prob, dtmax=0.001)
    ```

    ```Julia
    begin
    	const nn = []
    	for u in sol.u
    		push!(nn, u[1])
    	end
    end
    ```

    ```Julia
    begin
    	fig = Plots.plot(
    		dpi=150,
    		grid=:xy,
    		gridcolor=:black,
    		gridwidth=1,
    		size=(800, 400),
    		legend=:outerbottom,
    		xlabel="t",
    		ylabel="n(t)",
    		plot_title="Эффективность рекламы")

    	Plots.plot!(fig[1], sol.t, nn, color=:blue, label="n(t) — число потребителей, узнавших о товаре и готовых его купить")
    	Plots.vline!(fig[1], [max_der[3]], color=:grey, label="")
    	Plots.scatter!(fig[1], [max_der[3]], [max_der[2]], color=:grey,     markerstrokewidth=0.2, markersize=4, label="t=" * string(max_der[3]) * " — время, в момент которого скорость распространения рекламы максимальна")
    end
    ```

    ![Импорт библиотек](image/Screenshot_1.png){#fig:01 width=86%}

    ![Задание коэффициентов; списка, содержащего $\dot n$, $n$, $t$ для нахождения и отрисовки точки с максимальной производной; начальных условий; периода времени](image/Screenshot_2.png){#fig:02 width=86%}

    ![Запись уравнения в виде функции, а также стандартного поиска максимума среди значений производной с записью необходимых данных в список. Постановка проблемы](image/Screenshot_3.png){#fig:03 width=86%}

    ![Решение задачи (максимальное $\delta t$ равно $0.001$)](image/Screenshot_4.png){#fig:04 width=86%}

    ![Формирование массива, содержащего значения функции $n(t)$](image/Screenshot_5.png){#fig:05 width=86%}

    ![Отрисовка графика](image/Screenshot_6.png){#fig:06 width=86%}


### Задание №2

1. Изменены значения коэффициентов $\alpha_1$ и $\alpha_2$, а также период времени `T`. Остальные блоки кода оставляем без изменений. Любуемся результатом (рис. @fig:07, @fig:08).

    ```Julia
    begin
    	const N = 610
    	const n₀ = 10
    	const α₁ = 0.77
    	const α₂ = 0.00017

    	"max_der[1] - dn/dt, max_der[2] - n, max_der[3] - t"
    	max_der = [-1e6, 0, 0]

    	"Начальные условия: u₀[1] - n"
    	u₀ = [n₀]

    	"Период времени"
    	T = (0.0, 30.0)
    end
    ```

    ![Изменение значений $\alpha_1$, $\alpha_2$, периода времени `T`](image/Screenshot_7.png){#fig:07 width=86%}

    ![Результат в виде графика](image/Screenshot_8.png){#fig:08 width=86%}


### Задание №3

1. Изменены значения коэффициентов $\alpha_1$ и $\alpha_2$, период времени `T` и ОДУ в функции `F!`. Остальные блоки кода оставляем без изменений. Любуемся результатом (рис. @fig:09, @fig:10).

    ```Julia
    begin
    	const N = 610
    	const n₀ = 10
    	const α₁ = 0.5
    	const α₂ = 0.3

    	"max_der[1] - dn/dt, max_der[2] - n, max_der[3] - t"
    	max_der = [-1e6, 0, 0]

    	"Начальные условия: u₀[1] - n"
    	u₀ = [n₀]

    	"Период времени"
    	T = (0.0, 0.5)
    end
    ```

        ```Julia
    "Правая часть нашей системы, p не используется. u[1] - n"
    function F!(du, u, p, t)
    	du[1] = (α₁ * t + α₂ * t * u[1]) * (N - u[1])

    	if du[1] > max_der[1]
    		max_der[1] = du[1]
    		max_der[2] = u[1]
    		max_der[3] = t
    	end
    end
    ```

    ![Изменение значений $\alpha_1$, $\alpha_2$, периода времени `T`, функции `F!`](image/Screenshot_9.png){#fig:09 width=86%}

    ![Результат в виде графика](image/Screenshot_10.png){#fig:10 width=86%}


## Julia
### Задание №1

1. Код на Julia в файле аналогичен тому же, что написан с использованием Pluto (рис. @fig:11, @fig:001). Единственные различия: 
    - блоки перенесены в файл в виде построчного алгоритма без повторяющихся `begin` и `end`;
    - измененный синтаксис подключения библиотек;
    - выгрузка графиков в виде изображений при помощи метода в последней строчке кода.

    ```Julia
    using DifferentialEquations
    using Plots


    const N = 610
    const n₀ = 10
    const α₁ = 0.77
    const α₂ = 0.00017

    "max_der[1] - dn/dt, max_der[2] - n, max_der[3] - t"
    max_der = [-1e6, 0, 0]

    "Начальные условия: u₀[1] - n"
    u₀ = [n₀]

    "Период времени"
    T = (.0, 10.0)

    "Правая часть нашей системы, p не используется. u[1] - n"
    function F!(du, u, p, t)
    	du[1] = (α₁ + α₂ * u[1]) * (N - u[1])

    	if du[1] > max_der[1]
    		max_der[1] = du[1]
    		max_der[2] = u[1]
    		max_der[3] = t
    	end
    end


    prob = ODEProblem(F!, u₀, T)
    sol = solve(prob, dtmax=.1)


    const nn = []
    for u in sol.u
    	push!(nn, u[1])
    end

    fig = Plots.plot(
    	dpi=150,
    	grid=:xy,
    	gridcolor=:black,
    	gridwidth=1,
    	size=(800, 400),
    	legend=:outerbottom,
    	xlabel="t",
    	ylabel="n(t)",
    	plot_title="Эффективность рекламы")

    Plots.plot!(fig[1], sol.t, nn, color=:blue, label="n(t) — число потребителей,     узнавших о товаре и готовых его купить")
    Plots.vline!(fig[1], [max_der[3]], color=:grey, label="")
    Plots.scatter!(fig[1], [max_der[3]], [max_der[2]], color=:grey, markerstrokewidth=0.    2, markersize=4, label="t=" * string(max_der[3]) * " — время, в момент которого     скорость распространения рекламы максимальна")

    savefig(fig, "../lab7_1")
    ```


    ![Код программы на Julia. Аналогичен коду задания для Pluto.jl](image/Screenshot_11.png){#fig:11 width=86%}

    ![Результат в виде графика](image/lab7_1.png){#fig:001 width=86%}


### Задание №2

1. Изменяем значения коэффициентов $\alpha_1$ и $\alpha_2$, а также период времени `T` (подробное объяснение давалось в предыдущей главе) (рис. @fig:12, @fig:002).

    ```Julia
    const N = 11000
    const I₀ = 111
    const R₀ = 11
    const S₀ = N - I₀ - R₀
    const I⁺ = 100
    @show S₀
    ```

    ![Измененная часть кода](image/Screenshot_12.png){#fig:12 width=86%}

    ![Результат в виде графиков](image/lab7_2.png){#fig:002 width=86%}


### Задание №3

1. Изменяем значения коэффициентов $\alpha_1$ и $\alpha_2$, период времени `T` и ОДУ в функции `F!` (подробное объяснение давалось в предыдущей главе) (рис. @fig:13, @fig:003).

    ```Julia
    const N = 11000
    const I₀ = 111
    const R₀ = 11
    const S₀ = N - I₀ - R₀
    const I⁺ = 100
    @show S₀
    ```

    ![Измененная часть кода](image/Screenshot_13.png){#fig:13 width=86%}

    ![Результат в виде графиков](image/lab7_3.png){#fig:003 width=86%}


## Modelica
### Задание №1

1. По аналогии с Julia пишем программу, воспроизводящую модель рекламной кампании на языке моделирования Modelica с использованием ПО OpenModelica. Любуемся результатами (рис. @fig:14, @fig:15).
    
    ```
    model lab7_1
      constant Real alpha_1 = 0.77;
      constant Real alpha_2 = 0.00017;
      constant Integer N = 610;
      constant Integer n_0 = 10;
      Real t = time;
      Real n(t);
    initial equation
      n = n_0;
    equation
      der(n) = (alpha_1 + alpha_2 * n) * (N - n);
      annotation(experiment(StartTime=0, StopTime=10, Interval = 0.1));
    end lab7_1;
    ```

    ![Определяем коэффициенты, функцию $n$ от времени, ОДУ, а также начальное/конечное время и частоту разбиения при симуляции](image/Screenshot_14.png){#fig:14 width=86%}

    ![Результат в виде графика зависимости $n$ от $t$](image/Screenshot_15.png){#fig:15 width=86%}


### Задание №2

1. По аналогии с Julia пишем программу для второго случая. Любуемся результатами (рис. @fig:16, @fig:17, @fig:18).

    ```
    model lab7_2
      constant Real alpha_1 = 0.000055;
      constant Real alpha_2 = 0.29;
      constant Integer N = 610;
      constant Integer n_0 = 10;
      Real t = time;
      Real n(t);
    initial equation
      n = n_0;
    equation
      der(n) = (alpha_1 + alpha_2 * n) * (N - n);
      annotation(experiment(StartTime=0, StopTime=0.1, Interval = 0.001));
    end lab7_2;
    ```

    ![По сравнению с предыдущим случаем измянются значение коэффициентов `alpha_1`, `alpha_2`, период времени и частота разбиения](image/Screenshot_16.png){#fig:16 width=86%}

    ![Результат в виде графика зависимости $n$ от $t$](image/Screenshot_17.png){#fig:17 width=86%}

    ![Максимальное значение производной достигается в момент времени $t=0.23$](image/Screenshot_18.png){#fig:18 width=86%}


### Задание №3

1. По аналогии с Julia пишем программу для третьего случая. Любуемся результатами (рис. @fig:19, @fig:20).

    ```
    model lab7_3
      constant Real alpha_1 = 0.5;
      constant Real alpha_2 = 0.3;
      constant Integer N = 610;
      constant Integer n_0 = 10;
      Real t = time;
      Real n(t);
    initial equation
      n = n_0;
    equation
      der(n) = (alpha_1 * t + alpha_2 * t * n) * (N - n);
      annotation(experiment(StartTime=0, StopTime=0.5, Interval = 0.01));
    end lab7_3;
    ```

    ![По сравнению с предыдущим случаем измянются значение коэффициентов `alpha_1`, `alpha_2`, ОДУ, период времени и частота разбиения](image/Screenshot_19.png){#fig:19 width=86%}

    ![Результат в виде графика зависимости $n$ от $t$](image/Screenshot_20.png){#fig:20 width=86%}


# Анализ результатов

На текущем примере построения математической модель рекламной кампании мы можем продолжить сравнивать язык программирования Julia и язык моделирования Modelica. Если быть откровенным, по сравнению с анализом результатов при выполнении предыдущей лабораторной работы изменения незначительны: тенденция к сглаживанию негативных моментов при выполнении лабораторной работы на языке программирования Julia по сравнению с языком моделирования Modelica продолжается. Со временем и с новыми заданиями, решаемыми при помощи библиотеки DifferentialEquations, скорость написания программ на Julia почти сравнялась с таковой скоростью при использовании Modelica.

На языке Julia можно явно найти момент времени, во время которого скорость изменения функции $n(t)$ (т.е. $\dot n$) максимальна, т.к. мы можем напрямую взаимодействовать со значениями производной в каждый момент времени, обусловленный шагом разбиения. Это позволяет достаточно легко находить максимальное значение производной на периоде, момент времени в этой точки, а также само значение функции $n(t)$ в этой точке.

При написании же программы на Modelica приходится вручную искать максимальное значение по графику производной функции $n(t)$.

С другой стороны, хотелось бы отметить, что в Modelica в разы удобнее составлять уравнения, т.к. все переменные, зависящие от времени, подписываются заданными ранее символами в отличие от Julia, где каждой переменной соответствует элемент массива. Такая реализация может запутать, что может привести к ошибкам, связанными с усидчивостью, при описании модели.

# Выводы

Продолжил знакомство с функционалом языка программирования Julia, дополнительных библиотек (DifferentialEquations, Plots), интерактивного блокнота Pluto, а также интерактивной командной строкой REPL. Продолжил ознакомление с языком моделирования Modelica и программным обеспечением OpenModelica. Используя эти средства, описал математическую модель рекламной кампании.


# Список литературы{.unnumbered}

::: {#refs}
:::
